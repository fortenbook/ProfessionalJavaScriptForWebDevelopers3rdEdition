# 第五章 引用类型

引用类型的值是引用类型的一个实例，即对象。在ECMAScript中，引用类型是一种数据结构，将数据和行为组织在一起。在ECMAScript中没有类的概念。

## 5.1 Object类型

Object是ECMAScript中使用最多的一个类型，大多数引用类型的值都是此类型的实例。

创建Object实例的方式有两种。

第一种是使用new操作符后跟Object构造函数：

```
var person = new Object();
person.name = "Tom";
person.age = 18;
person.gender = "M";
```

第二种是使用对象字面量表示法。这种方式一般用于简化包含大量属性的对象的创建过程。

```
var person = {
	name : "Tom",
	age : 18,
	gender : "M"
}
```

一对花括号界定了对象字面量，其中是三对属性名值对，属性名值对使用冒号分隔，多个属性名值对之间用逗号分隔。

在使用对象字面量语法时属性名可以使用字符串：

```
var person = {
	"name" : "Tom",
	"age" : 18,
	"gender" : "M",
	10 : "Ten"
}
```

这里的最后一个属性名是数字10，会被自动转型为字符串"10"。可以使用person["10"]这种语法来访问此属性值，后有详细介绍。

使用对象字面量语法时，如果留空花括号，则可以定义只包含默认属性和方法的对象：

```
var person = {}; //与使用new Object()相同
// 以下代码为person对象进行属性扩展
person.name = "Tom";
person.age = 18;
```

>在现代浏览器中，通过对象字面量定义对象时，实际上不会调用Object构造函数。

开发者一般更喜欢使用对象字面量的语法，因为其代码量较少，并且有封装数据的感觉。同时，对象字面量还能向函数中传递大量可选参数：

```
// 参数person有可能是一个对象，并且可能带有name和（或）age属性
function getPersongInfo(person){
	var str = "";
	// 检测name属性是否存在
	if(typeof person.name == "string"){
		str = str + "姓名：" + person.name + "\n";
	}
	// 检测age属性是否存在
	if(typeof person.age == "number"){
		str = str + "年龄：" + person.age + "岁";
	}
	console.log(str);
}

// 调用此函数，并把一个带有name和age属性的对象作为参数传递给它
getPersonInfo({
	name : "张飞",
	age : 32
});
/*
 * 输出:
 * 姓名：张飞
 * 年龄：32岁
 */

// 调用此函数，并把一个只带有name属性的对象作为参数传递给它
getPersonInfo({
	name : "张飞"
});
/*
 * 输出:
 * 姓名：张飞
 */
```

>**这种使用场景适用于需要向函数传递大量参数是情况。最佳实践是把必需的参数定义为命名参数，可选参数封装在一个对象字面量中再传递给函数。**

对象属性可以使用点号操作符来访问，这是比较通用的语法。而在JavaScript中也可以使用方括号来访问对象的属性。使用这种语法时，方括号中的属性名应该以字符串形式体现。

```
person.name;
person["name"];
```

以上代码从功能上看，这两种访问对象属性的方法没有任何区别。但方括号语法的主要优点是可以通过变量来访问属性：

```
var person = {
	name : "张飞",
	age : 32
};
var propertyName = "age";
person[propertyName];// 18
propertyName = "name";
person[propertyName];// "张飞"
```

属性名中如果包含了会导致语法错误的字符，必须使用方括号方式访问它。如果属性名是关键字或保留字，也可以使用方括号方式访问：

```
var p = {
	'first-name': "Tom",// 减号不是合法的标识符字符，所以这里必须使用字符串形式表示属性名
	lastName : "Green"
};

p.lastName; // "Green"
p["lastName"]; // "Green"
// p.first-name; // 错误
p["first-name"]; // "Tom"
```

>通常除非必须使用变量来访问属性，否则我们建议使用点号表示。

## 5.2 Array类型

Array类型也是ECMAScript中最常用的类型。ECMAScript中的数组与其它语言相比，有很大的区别。数组是数据有**有序列表**，但ECMAScript数组的每一个元素可能是不同类型的数据，同时数组的长度可以动态调整（加长或缩短）。

创建数组的基本方式有两种。

第一种是使用Array构造函数：

```
var arr1 = new Array();// 声明并实例化空数组对象
var arr2 = new Array(20);// 声明并实例化初始容量为20个元素的数组对象
var arr3 = new Array("Tom",30,true);// 声明并实例化包含"Tom"、30、true三个元素的数组对象
// 如果Array的构造函数只有一个整数类型参数，则其表示数组的容量
// 如果Array的构造函数有多个整数类型的参数，则它们表示数据的元素值
var arr4 = new Array(2);// 声明并实例化初始容量为两个元素的数组对象
var arr5 = new Array(1,2,3,4,5);// 声明并实例化包含整数1到5的数组对象
var arr6 = new Array("Tom");// 声明并实例化只包含"Tom"一个元素的数组对象
```

第二种是使用数组字面量表示法：由一对包含数组元素的方括号来表示的，各元素之间用逗号分隔。

```
var arr1 = ['someone',18,false,20000];// 创建了一个容量为4的数组
var arr2 = [];// 创建了一个空数组
var arr3 = [1,2,];// 不推荐，根据浏览器的不同，可以创建包含两个或三个元素的数组
var arr4 = [,,,,,];// 不推荐，根据浏览器的不同，可以创建包含五个或六个元素的数组
```

>在现代浏览器中，通过数组字面量创建数组时，实际上不会调用Array构造函数。

在访问或改变数组元素值时，需要使用方括号加元素索引的方式。第一个元素的索引是0，最后一个元素的索引是数组长度减一（arr.length-1）。

```
var arr = ['black','3px',20];
arr[0];// 'black' 访问数组第一个元素
arr[1] = true;// 替换第二个元素的值为true，即['black',true,20]
arr[3] = 'new value';// 新增第四个元素，值为'new value'，即['black',true,20,'new value']
```

数组对象有一个length属性，用于保存数组对象中当前的元素总数，其取值范围是0~4294967295。**length属性不是只读的**。

```
var arr1 = [];
var arr2 = [1,2,3,4,5];
console.log(arr1.length);// 0
console.log(arr2.length);// 5

arr2.length = 3;
console.log(arr2);// [1,2,3] 因为重新设置arr2的容量为3，所以第四个元素及其后的所有元素都被丢弃
arr2.length = 5;
console.log(arr2);// [1,2,3,undefined,undefined] 重新设置arr2的容量为5，对数组增加了两个元素容量，元素值默认是undefined
```

通过length属性可以方便的在数组末尾添加新元素，代码如下：

```
var arr1 = ['apple','orange','grape'];
arr1[arr1.length] = 'watermelon';// ['apple','orange','grape','watermelon']
arr1[arr1.length] = 'peach';// ['apple','orange','grape','watermelon','peach']
```

当把一个元素放在超出当前数组大小的位置上时，数组就会重新计算容量。

```
var arr1 = ['apple','orange','grape'];
arr1[9] = 'peach';
console.log(arr1.length);// 10
```

### 5.2.1 检测数组

有两种方式可以判断某个变量是否是数组：instanceof操作符和Array.isArray(value)函数。

```
// 使用instanceof操作符判断的代码
if(value instanceof Array){
	...
}

// 使用ArrayisArray(value)函数判断的代码
if(Array.isArray(value)){
	...
}
```

### 5.2.2转换方法

所有对象都有valueOf()、toString()、toLocaleString()三个方法。对于数组来说，调用valueOf()方法会返回数组；调用toString()方法会返回一个由各元素toString()返回的字符串加上逗号分隔的长字符串，toLocaleString()与toString()方法类似，只不过是调用各元素的toLocaleString()方法。

```
var arr = [1,2,3,4,5];
arr.valueOf();// [1, 2, 3, 4, 5]

arr.toString();// "1,2,3,4,5"

arr.toLocaleString();// "1,2,3,4,5"
```

当调用数组的toLocaleString()方法时，如果某个元素没有定义toLocaleString()方法，则调用它的toString()方法。

```
var obj1 = {
	toLocaleString : function(){
		return "张辽";
	},

	toString : function(){
		return "Zhang Liao";
	}
};

var obj2 = {
	toString : function(){
		return "Lv Bu";
	}
};

var persons = [obj1,obj2];

persons.toString(); // "Zhang Liao,Lv Bu"
persons.toLocaleString(); // "张辽,Lv Bu"

obj2.toLocaleString = function(){
	return "吕布";
};

persons.toString(); // "Zhang Liao,Lv Bu"
persons.toLocaleString(); // "张辽,吕布"
```

join()函数可以把数组元素以指定的分隔符连接成一个字符串。

```
var arr = [1,2,3,4,5];
arr.join(';'); // "1;2;3;4;5"
arr.join(' and '); // "1 and 2 and 3 and 4 and 5"
arr[arr.length] = null;
arr[arr.length] = undefined;

// 如果数组中包含值为null或undefined的元素，toString()、toLocaleString()、join()函数会把它们处理成空串
arr.valueOf(); // [1, 2, 3, 4, 5, null, undefined]
arr.toString(); // "1,2,3,4,5,,"
arr.toLocaleString(); // "1,2,3,4,5,,"
arr.join('|'); // "1|2|3|4|5||"
```

### 5.2.3 栈方法

- push()方法：可以接收任意数量的参数，把它们逐个添加到数组末尾，并返回添加元素后的数组容量。
- pop()方法：移除数组最后一个元素，对数组容量减1，然后返回被移除的项。

```
var fruits = [];
fruits.push('apple','orange');// 2
fruits.length;// 2

fruits.push('peach');// 3

fruits.pop();// "peach"
fruits.length;// 2
```

### 5.2.4 队列方法

- unshift()方法：在数组开始处添加任意个元素，返回新的数组容量
- shift()方法：移除并返回数组的第一个元素，数组的容量减1

通常shift()与push()方法配合使用可以模拟队列。

```
var colors = [];
colors.push('red','green');// 2
colors.push('white');// 3
colors.length;// 3

colors.shift();// 'red'
colors.length;// 2
```

而使用unshift()和pop()方法配合使用来模拟反向队列。

```
var colors = [];
colors.unshift('red','green');// 2
colors.unshift('white');// 3
colors.length;// 3

colors.pop();// 'green'
colors.length;// 2
```

### 5.2.5 排序方法

- reverse()方法：会反转数组项的顺序(最后一个元素变成第一个元素，第一个元素变成最后一个元素)
- sort()方法：按升序排列数组元素

```
var arr = [1,3,4,5,2];
arr.reverse();// [2, 5, 4, 3, 1]
arr.sort();// [1, 2, 3, 4, 5]
```

sort()函数还可以接收一个比较器函数作为参数。这个比较器函数有两个参数，如果第一个参数应该位于第二个参数前，则需要返回正值，如果第一个参数应该位于第二个参数后，则需要返回负值，如果两个参数相等则返回0。

```
// 升序比较函数
function compare(v1,v2){
	if(v1<v2){
		return -1;
	}else if(v1>v2){
		return 1;
	}else{
		return 0;
	}
}

var arr = [0,1,6,10,20];
arr.sort(compare);// [0, 1, 6, 10, 20]

// 降序比较函数
function reverseCompare(v1,v2){
	if(v1<v2){
		return 1;
	}else if(v1>v2){
		return -1;
	}else{
		return 0;
	}
}

arr = [0,1,6,10,20];
arr.sort(reverseCompare);// [20, 10, 6, 1, 0]
```

对于数值类型或valueOf()函数返回数值类型的对象，可以使用更简单的比较函数：

```
function compare(v1,v2){
	return v1-v2;
}
```

### 5.2.6 操作方法

1.concat()方法：可以基于当前数组中的所有元素创建一个新数组。

首先会创建当前数组的一个副本。如果有参数传入，则把这些参数添加到副本数组的末尾。如果参数是数组，则进行拼接，如果是单独的值，则进行元素的添加。

```
var colors = ['red','green','blue'];
var newColors = colors.concat();// 仅创建colors数组的一个副本
colors;// ["red", "green", "blue"]
newColors;// ["red", "green", "blue"]
```

```
var colors1 = ['red','green','blue'];
var colors2 = colors1.concat('white');// 添加元素
var colors3 = ['black','yellow'];
var colors4 = colors2.concat(colors3,'brown');// 拼接数组，并添加元素

colors1;// ["red", "green", "blue"]
colors2;// ["red", "green", "blue", "white"]
colors3;// ["black", "yellow"]
colors4;// ["red", "green", "blue", "white", "black", "yellow", "brown"]
```

2.slice()方法：可以基于当前数组的元素来创建一个新数组。此方法参数可以是一个或两个，描述着返回元素的起始和结束位置。

在只有一个参数的情况下，返回的是从该参数所指定的位置到数组结束处的所有元素。

```
var colors1 = ['red','green','blue','white','black'];
var colors2 = colors.slice(1);// ['green','blue','white','black']
```

如果有两个参数，该方法返回起始和结束位置之间的元素，但不包含结束位置的元素。

```
var colors1 = ['red','green','blue','white','black'];
var colors2 = colors.slice(1,4);// ['green','blue','white']
```





